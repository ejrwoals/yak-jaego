# 약국 재고 관리 및 분석 시스템 (Jaego)

> **⚡ 빠른 시작**:
> 1. **관리자**: `python init_db.py` (최초 1회, DB 초기화)
> 2. **사용자**: `python web_app.py` (웹 브라우저에서 실행)

## 🏥 프로젝트 개요

**yak-jaego**는 약국의 재고 관리와 사용량 분석을 위한 Python 기반 자동화 도구입니다. SQLite 데이터베이스 기반으로 여러 개의 월별 CSV 파일을 통합하여 시계열 분석을 수행하고, 시각적으로 이해하기 쉬운 인터랙티브 HTML 보고서를 생성합니다.

### 🎯 핵심 아키텍처

**SQLite 데이터베이스 기반 시스템**
- `recent_inventory.sqlite3`: 각 약품의 최신 재고 수량 저장
- `processed_inventory.sqlite3`: 시계열 통계 데이터 (1년 이동평균, 3개월 이동평균, 런웨이 등)
- **약품별 최신 재고 추적**: 각 약품마다 가장 최근에 기록된 재고를 자동 채택
- **음수 재고 지원**: 마이너스 재고도 정확히 반영

### 🔀 두 가지 워크플로우

1. **📊 재고 관리 보고서 생성 (시계열 분석)**
   - 월별 CSV 데이터의 시계열 분석 및 트렌드 파악
   - 장기적인 조제 패턴 분석 및 통계 생성
   - 전문약/일반약 개별 보고서 생성

2. **📦 약 주문 수량 산출**
   - **today.csv에 있는 약품만** 표시 (오늘 나간 약품)
   - 현재 재고와 과거 소비 패턴 기반 주문 필요 약품 식별
   - 런웨이(재고 소진 예상 기간) 기반 우선순위 정렬

### 📊 주요 기능

#### 공통 기능
- **🗄️ SQLite 데이터베이스**: 안정적인 데이터 저장 및 관리
- **🔄 월별 CSV 자동 통합**: 여러 개의 월별 CSV 파일을 약품코드 기준으로 자동 병합
- **🧮 다중 인코딩 지원**: UTF-8, CP949, EUC-KR 인코딩 자동 감지
- **💾 데이터 무결성**: 약품코드 string 처리 및 float 형태 자동 정규화
- **📅 최신 재고 자동 채택**: 각 약품별로 가장 최근 월의 재고 자동 선택
- **➖ 음수 재고 지원**: 마이너스 재고 정확히 반영

#### 워크플로우 1: 시계열 분석
- **💊 전문약/일반약 분리 분석**: 조제수량(전문약) 또는 판매수량(일반약) 기준 선택 가능
- **🎯 자동 필터링**: 전체 기간 동안 소모량이 0인 품목 자동 제외
- **📈 시계열 분석**: 시간에 따른 소모량 변화 추세 분석 및 1년/3개월 이동평균 계산
- **⚡ 경량 스파크라인**: SVG 기반 초경량 트렌드 차트로 빠른 로딩
- **🎯 On-demand 상세 차트**: 클릭시에만 Plotly 차트 동적 생성으로 성능 최적화
- **🔍 즉각 검색**: 전체 약품 목록에서 실시간 검색

#### 워크플로우 2: 주문 수량 산출
- **📋 today.csv 기반 필터링**: 오늘 나간 약품만 표시
- **🔄 자동 재고 업데이트**: today.csv 발견 시 DB 자동 업데이트
- **🚨 긴급 주문 식별**: 런웨이 1개월 미만 약품 자동 하이라이트
- **📊 런웨이 이중 계산**: 1년 이동평균 및 3개월 이동평균 기반 두 가지 런웨이 제공
- **🎨 색상 코딩**: 재고 부족 약품을 빨간색으로 강조 표시
- **📋 자동 정렬**: 런웨이 오름차순으로 긴급도 순서 정렬

## 🚀 빠른 시작

### 필수 요구사항

- Python 3.7 이상
- pip (Python 패키지 관리자)

### 설치 방법

1. **저장소 클론**
   ```bash
   git clone https://github.com/ejrwoals/yak-jaego.git
   cd yak-jaego
   ```

2. **가상환경 설정 (권장)**
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Windows: .venv\Scripts\activate
   ```

3. **의존성 설치**
   ```bash
   pip install -r requirements.txt
   ```

### 데이터 준비

#### 월별 CSV 파일 준비 (필수)

1. **Excel 파일을 월별 CSV로 변환**:
   - Excel에서 월별 약품 사용량 파일을 엽니다
   - `파일` → `다른 이름으로 저장` → `CSV(쉼표로 분리)(*.csv)` 선택
   - 파일명에 날짜 정보 포함 (예: `2025-01.csv`, `2025-02.csv` 또는 `202501.csv` 형식)
   - `data/` 폴더에 모든 월별 파일을 저장합니다

2. **CSV 파일 형식 요구사항**:
   - `약품명`: 의약품명
   - `제약회사`: 제조회사명
   - `약품코드`: 고유 식별 코드 (숫자/문자 혼합 가능, 자동으로 string 처리)
   - `재고수량`: 현재 재고량 (음수 가능)
   - `조제수량`: 해당 월의 사용량 (전문약의 경우)
   - `판매수량`: 해당 월의 판매량 (일반약의 경우)

3. **파일명 규칙**:
   - 지원 형식: `YYYY-MM.csv`, `YYYYMM.csv`, `YYYY_MM.csv`, `YYYY년 MM월.csv`
   - 예시: `2025-01.csv`, `202501.csv`, `2025_01.csv`, `2025년 1월.csv`

#### today 파일 준비 (워크플로우 2에 필요)

1. **today 파일** (CSV 또는 Excel 형식):
   - 오늘 나간 약품의 재고 현황을 담은 파일
   - **웹 UI에서 직접 업로드** 가능 (파일명 자유)
   - 지원 형식:
     - `*.csv` (CSV 파일)
     - `*.xls` (Excel 97-2003 파일, 윈도우 호환)
     - `*.xlsx` (최신 Excel 파일)
   - 필수 컬럼: `약품명`, `약품코드`, `제약회사`, `재고수량`
   - **중요**: 업로드한 파일에 있는 약품들만 주문 보고서에 표시됩니다
   - **편의성**: Excel 파일을 CSV로 수동 변환할 필요 없이 바로 사용 가능

## 📖 사용 방법

### 🔧 1단계: DB 초기화 (관리자, 최초 1회)

```bash
python init_db.py
```

**실행 과정:**
1. `data/` 폴더의 모든 월별 CSV 파일 로드
2. 전문약 데이터 처리 및 통계 계산
3. 일반약 데이터 처리 및 통계 계산
4. `recent_inventory.sqlite3` 생성 (각 약품의 최신 재고)
5. `processed_inventory.sqlite3` 생성 (시계열 통계 데이터)

**생성되는 DB:**
- `recent_inventory.sqlite3`: 현재 재고 데이터
  - 약품코드, 약품명, 제약회사, 약품유형(전문약/일반약), 현재_재고수량
  - 각 약품별로 가장 최근에 기록된 재고를 자동 채택
- `processed_inventory.sqlite3`: 시계열 통계 데이터
  - 1년_이동평균, 월별_조제수량_리스트, 3개월_이동평균_리스트, 런웨이 등

### 🎯 2단계: 워크플로우 실행 (사용자)

```bash
python web_app.py
```

**실행 과정:**
1. 명령어 실행 시 웹 브라우저가 자동으로 열립니다 (http://127.0.0.1:5000)
2. 랜딩 페이지에서 원하는 워크플로우 버튼 클릭:
   - **재고 관리 보고서**: 전문약/일반약 시계열 분석
   - **약 주문 수량 산출**: 런웨이 기반 주문 계산
3. 보고서가 자동으로 생성되어 새 탭에서 열립니다
4. 종료: 터미널에서 `Ctrl+C`

**특징:**
- 직관적인 그래픽 인터페이스
- 클릭만으로 워크플로우 실행
- 보고서는 새 탭에서 열려 메인 앱과 독립적으로 사용 가능
- 여러 보고서를 연속으로 생성하고 비교 가능

### 워크플로우 1: 시계열 분석 보고서

**실행 과정:**
1. **보고서 유형 선택**:
   - `1` 입력: 전문약 보고서 (조제수량 기준)
   - `2` 입력: 일반약 보고서 (판매수량 기준)
2. `processed_inventory.sqlite3`에서 데이터 로드
3. 선택한 약품유형만 필터링
4. HTML 보고서 생성 및 브라우저에서 자동 열기

**출력 파일:**
- `inventory_report_dispense_YYYYMMDD_HHMMSS.html`: 전문약 시계열 분석 보고서
- `inventory_report_sale_YYYYMMDD_HHMMSS.html`: 일반약 시계열 분석 보고서

**보고서 내용:**
- 📈 재고 현황 요약 통계
- 📊 런웨이 분석 차트 (재고 부족/충분 약품 분류)
- 🔍 상세 재고 테이블 (검색/정렬 기능, 스파크라인)
- ⚠️ 주의사항 약품 목록 (재고 부족 3개월 이하)

### 워크플로우 2: 주문 수량 산출

**실행 전 요구사항:**
- 오늘 나간 약품의 재고 현황 파일 (csv/xls/xlsx, 웹 UI에서 업로드)
- `processed_inventory.sqlite3`: init_db.py로 생성된 DB
- `recent_inventory.sqlite3`: init_db.py로 생성된 DB

**실행 과정:**
1. 웹 UI에서 재고 현황 파일 업로드 (파일명 자유)
2. 업로드된 파일로 자동으로 `recent_inventory.sqlite3` 업데이트
3. 업로드된 파일에서 오늘 나간 약품 코드 추출
4. processed_inventory DB에서 시계열 통계 로드
5. recent_inventory DB에서 현재 재고 로드 → **업로드 파일 약품만 필터링**
6. 데이터 병합 및 런웨이 계산
7. HTML/CSV 보고서 생성 (런웨이 오름차순 정렬)

**출력 파일:**
- `order_calc_reports/order_calculator_report_YYYYMMDD_HHMMSS.html`: 주문 권장 보고서
- `order_calc_reports/order_calculator_report_YYYYMMDD_HHMMSS.csv`: 주문 권장 데이터

**보고서 특징:**
- 🚨 런웨이 < 1개월 약품은 빨간색으로 강조
- 📋 오늘 나간 약품만 표시 (업로드된 파일 기준)
- 📊 긴급도 순서로 자동 정렬
- 📈 1년 이동평균 및 3개월 이동평균 기반 이중 런웨이 제공

### 🔄 재고 업데이트 (선택 사항)

today 파일을 업데이트한 후 DB만 갱신하고 싶을 때:

```bash
python inventory_updater.py
```

**동작:**
- today 파일(csv/xls/xlsx)의 재고 정보를 `recent_inventory.sqlite3`에 반영
- UPSERT 방식으로 안전하게 업데이트 (중복 실행해도 안전)
- 워크플로우 2를 실행하면 자동으로 실행되므로 선택 사항

## 📁 프로젝트 구조

```
yak-jaego/
├── data/                          # 입력 CSV 데이터 폴더
│   ├── 2023-09.csv                # 2023년 9월 데이터
│   ├── 2023-10.csv                # 2023년 10월 데이터
│   ├── 2024-01.csv                # 2024년 1월 데이터
│   └── ...                        # 기타 월별 데이터
├── templates/                     # 웹 UI HTML 템플릿 폴더
│   ├── index.html                 # 랜딩 페이지
│   ├── workflow_timeseries.html   # 시계열 분석 워크플로우 페이지
│   ├── workflow_order.html        # 주문 계산 워크플로우 페이지
│   └── error.html                 # 에러 페이지
├── inventory_reports/             # 시계열 분석 보고서 폴더 (자동 생성)
│   └── inventory_report_YYYYMMDD_HHMMSS.html
├── order_calc_reports/            # 주문 수량 산출 보고서 폴더 (자동 생성)
│   ├── order_calculator_report_YYYYMMDD_HHMMSS.html
│   └── order_calculator_report_YYYYMMDD_HHMMSS.csv
├── init_db.py                     # 🔧 DB 초기화 스크립트 (관리자용)
├── web_app.py                     # 🌐 웹 UI 메인 애플리케이션 (사용자용)
├── read_csv.py                    # CSV 데이터 읽기 및 시계열 통합 모듈
├── generate_report.py             # 시계열 분석 HTML 보고서 생성 모듈
├── drug_order_calculator.py       # 주문 수량 산출 모듈
├── inventory_db.py                # recent_inventory.sqlite3 관리 모듈
├── processed_inventory_db.py      # processed_inventory.sqlite3 관리 모듈
├── inventory_updater.py           # 재고 업데이트 모듈 (today 파일 → DB)
├── utils.py                       # 공통 유틸리티 함수 (Excel 파일 읽기 포함)
├── requirements.txt               # Python 의존성 목록
├── today.csv/xls/xlsx             # 오늘 나간 약품의 재고 현황 (사용자 제공)
├── recent_inventory.sqlite3       # 최신 재고 DB (자동 생성)
├── processed_inventory.sqlite3    # 시계열 통계 DB (자동 생성)
└── README.md                      # 프로젝트 문서
```

## 🔧 상세 기능

### init_db.py - DB 초기화 (관리자용)

#### 주요 기능:
- **월별 CSV 통합**: data/ 폴더의 모든 CSV 파일 로드 및 통합
- **전문약/일반약 처리**: 두 가지 약품 유형을 모두 처리하여 DB에 저장
- **최신 재고 채택**: 각 약품별로 가장 최근 월의 재고를 자동 선택
- **통계 계산**: 1년 이동평균 (12개월), 3개월 이동평균, 런웨이 자동 계산
- **DB 생성**: recent_inventory.sqlite3 및 processed_inventory.sqlite3 생성

#### 실행 시점:
- 최초 설치 후 1회
- 새로운 월별 CSV 데이터가 추가되었을 때
- DB 재구축이 필요할 때

### web_app.py - 웹 UI 메인 애플리케이션 (사용자용)

#### 주요 특징:
- **Flask 기반 웹 인터페이스**: 브라우저에서 직관적으로 사용
- **DB 준비 상태 확인**: 두 개의 DB 존재 및 데이터 확인
- **워크플로우 선택**: 랜딩 페이지에서 버튼 클릭으로 워크플로우 실행
- **새 탭 보고서**: 보고서가 새 탭에서 열려 메인 앱과 독립적으로 사용
- **오류 처리**: DB 없으면 init_db.py 실행 안내

### inventory_db.py - 최신 재고 DB 관리

#### 주요 기능:
- `recent_inventory.sqlite3` 관리
- 테이블 스키마:
  ```sql
  CREATE TABLE recent_inventory (
      약품코드 TEXT PRIMARY KEY,
      약품명 TEXT,
      제약회사 TEXT,
      약품유형 TEXT,  -- '전문약' 또는 '일반약'
      현재_재고수량 REAL,  -- 음수 가능
      최종_업데이트일시 TEXT
  )
  ```
- UPSERT 연산 지원 (INSERT OR REPLACE)

### processed_inventory_db.py - 시계열 통계 DB 관리

#### 주요 기능:
- `processed_inventory.sqlite3` 관리
- 테이블 스키마:
  ```sql
  CREATE TABLE processed_inventory (
      약품코드 TEXT PRIMARY KEY,
      약품명 TEXT,
      제약회사 TEXT,
      약품유형 TEXT,
      "1년_이동평균" REAL,
      최종_재고수량 REAL,
      런웨이 TEXT,
      월별_조제수량_리스트 TEXT,  -- JSON
      "3개월_이동평균_리스트" TEXT,  -- JSON
      최종_업데이트일시 TEXT
  )
  ```
- JSON 직렬화로 Python 리스트 저장
- numpy 타입 자동 변환

### read_csv.py - CSV 데이터 처리 엔진

#### 주요 기능:

1. **월별 CSV 파일 자동 로드** (`load_multiple_csv_files`)
   - `data/` 폴더의 모든 CSV 파일 스캔
   - 파일명에서 날짜 정보 자동 추출 (정규표현식 사용)
   - 다중 인코딩 자동 감지 (UTF-8, CP949, EUC-KR)
   - 시간순 정렬

2. **약품코드 기준 시계열 통합** (`merge_by_drug_code`)
   - **전문약/일반약 모드 지원**: `mode='dispense'` (조제수량) 또는 `mode='sale'` (판매수량)
   - **약품코드 기준 lookup**: PRIMARY KEY로 안정적인 데이터 통합
   - **float 형태 자동 정규화**: `673400030.0` → `673400030` (중복 방지)
   - **최신 데이터 우선 채택**: 약품명/제약회사/재고수량 모두 역순 탐색으로 최신 월 우선
   - **약품명 변경 자동 반영**: 사용자가 약품명을 수정해도 약품코드 기준으로 자동 매칭 및 최신 값 채택
   - **음수 재고 지원**: 마이너스 재고도 정확히 반영
   - **자동 필터링**: 전체 기간 동안 소모량이 0인 약품 제외

3. **통계 계산** (`calculate_statistics`)
   - 1년 이동평균 산출 (최근 12개월 평균, 계절성 반영)
   - 3개월 이동평균 계산 (단기 추세 파악용)
   - 런웨이 계산 (재고 소진 예상 기간, 1년 이동평균 기반)

#### 데이터 무결성 보장:

```python
# 약품코드 정규화 예시
"673400030"   → "673400030"   # 이미 정수형
"673400030.0" → "673400030"   # float 형태 정규화
"ZP123456"    → "ZP123456"    # 문자 혼합 코드
```

#### 최신 데이터 채택 로직 (Robust Design):

```python
# 모든 메타데이터를 최신 월 우선으로 채택 (역순 탐색)
months_reversed = list(reversed(months))  # 2025-09 → 2025-08 → ...

# Step 1: 약품명/제약회사 채택 (최신 월 우선)
for month in months_reversed:
    if 약품이_해당_월에_존재 and 약품명이_유효함:
        약품명 = 해당_월의_약품명  # 사용자 변경 반영
        제약회사 = 해당_월의_제약회사
        break  # 최신 정보 발견

# Step 2: 월별 조제/판매 수량 수집 (시간순 정방향)
for month in months:  # 시계열 데이터는 정방향
    월별_수량_리스트.append(해당_월의_조제수량)

# Step 3: 재고수량 채택 (최신 월 우선)
for month in months_reversed:
    if 약품이_해당_월에_존재 and 재고수량이_유효함:
        재고수량 = 해당_월의_재고  # 음수 포함
        break  # 최신 재고 발견
```

**핵심 설계 원칙**:
- ✅ **약품코드**: PRIMARY KEY, 불변 식별자
- ✅ **약품명/제약회사**: 최신 월 우선 (사용자가 변경해도 자동 반영)
- ✅ **재고수량**: 최신 월 우선 (음수 포함)
- ✅ **월별 수량**: 시간순 (시계열 분석용)

### drug_order_calculator.py - 주문 수량 산출

#### 주요 기능:

1. **today.csv 기반 필터링**
   - today.csv에서 오늘 나간 약품 코드 추출
   - DB 데이터를 today.csv 약품만 필터링
   - 실용적인 주문 보고서 생성

2. **자동 재고 업데이트**
   - today.csv 발견 시 자동으로 inventory_updater 호출
   - recent_inventory.sqlite3 자동 업데이트

3. **런웨이 계산**
   - **1년 이동평균 런웨이**: 현재 재고수량 / 1년 이동평균 (기본)
   - **3-MA 런웨이**: 현재 재고수량 / 3개월 이동평균 (단기 추세)
   - 무한대 값 처리 (조제수량이 0인 경우 → 999로 표시)

4. **보고서 생성**
   - HTML 보고서: 색상 코딩 포함 인터랙티브 테이블
   - CSV 보고서: 엑셀 등에서 후처리 가능
   - 런웨이 오름차순 정렬 (긴급도 순서)

### inventory_updater.py - 재고 업데이트

#### 주요 기능:
- today 파일(csv/xls/xlsx) → recent_inventory.sqlite3 업데이트
- 다양한 Excel 형식 자동 감지 및 처리
- UPSERT 연산으로 안전한 업데이트
- 중복 실행해도 문제없음

### utils.py - 공통 유틸리티 함수

#### 주요 기능:
- **Excel 파일 읽기**: CSV, XLS, XLSX 형식 자동 감지
  - `calamine` 엔진: 윈도우에서 생성된 오래된 .xls 파일 지원
  - `openpyxl` 엔진: 최신 .xlsx 파일 지원
- 약품코드 정규화 및 데이터 검증
- 다중 인코딩 지원 (UTF-8, CP949, EUC-KR)

## 🎯 핵심 개선 사항

### v3.2 업데이트 (Excel 파일 직접 지원)

1. **Excel 파일 직접 읽기**
   - today.xls, today.xlsx 파일을 수동 변환 없이 바로 사용 가능
   - 윈도우에서 생성된 오래된 .xls 파일도 완벽 지원 (calamine 엔진)
   - 매일 Excel → CSV 변환 작업 불필요
   - 파일 형식 자동 감지 및 최적 엔진 선택

2. **개선된 사용자 경험**
   - 원본 Excel 파일을 그대로 사용
   - 변환 과정에서 발생하는 인코딩 문제 제거
   - 워크플로우 간소화

### v3.1 업데이트 (Robust 데이터 통합)

1. **약품명 변경 자동 반영**
   - 약품코드는 불변, 약품명은 변경 가능
   - 최신 월의 약품명/제약회사를 자동 채택 (역순 탐색)
   - 사용자가 약품명을 변경해도 약품코드 기준으로 자동 매칭
   - 예: "타이레놀정" → "타이레놀500mg정" 변경 시 자동 반영

2. **통일된 데이터 채택 정책**
   - 약품명, 제약회사, 재고수량 모두 **최신 월 우선** (역순 탐색)
   - 시계열 데이터(월별 조제수량)는 시간순 유지 (정방향)
   - 3단계 분리 로직으로 명확성 향상

### v3.0 주요 업데이트 (SQLite 기반 아키텍처)

1. **SQLite 데이터베이스 도입**
   - CSV 파일 대신 SQLite DB로 데이터 관리
   - 두 개의 DB: recent_inventory (최신 재고), processed_inventory (시계열 통계)
   - 약품코드를 PRIMARY KEY로 사용하여 안정적인 데이터 무결성 보장
   - UPSERT 연산으로 안전한 업데이트

2. **관리자/사용자 워크플로우 분리**
   - `init_db.py`: DB 초기화 (관리자, 최초 1회)
   - `web_app.py`: 웹 기반 보고서 생성 및 주문 계산 (사용자, 일상적 사용)
   - 직관적인 웹 UI

3. **최신 재고 자동 채택**
   - 각 약품별로 가장 최근 월의 재고를 자동 선택
   - 월별 CSV에 일부 약품만 있어도 문제없음
   - 역순 탐색으로 정확한 최신 재고 파악

4. **음수 재고 지원**
   - 마이너스 재고도 정확히 반영
   - 실제 약국 운영 상황 정확히 표현

5. **today 파일 기반 필터링**
   - 주문 보고서에 오늘 나간 약품만 표시
   - 실용적인 주문 계산
   - 불필요한 정보 제거
   - CSV, XLS, XLSX 형식 모두 지원

### v2.0 업데이트 (시계열 분석)

1. **시계열 분석 기능 추가**
   - 단일 CSV → 여러 월별 CSV 통합 분석
   - 시간에 따른 조제수량 변화 추적
   - 1년 이동평균으로 계절성 반영 및 장기 트렌드 파악
   - 3개월 이동평균으로 단기 추세 파악

2. **성능 대폭 개선**
   - 1800+ 약품 로딩 시간: 10초+ → 1-2초
   - HTML 파일 크기: 수십 MB → 수 MB
   - 검색 반응 속도 유지

3. **데이터 무결성 강화**
   - 약품코드 float 형태 자동 정규화
   - 같은 약품의 중복 라인 자동 병합
   - string 타입 일관성 보장

## 🛠️ 고급 설정

### DB 재구축

**새로운 월별 데이터가 추가되었을 때** (예: 2025-10.csv 추가):

```bash
# 1. data/ 폴더에 새 CSV 파일 추가
cp ~/Downloads/2025-10.csv data/

# 2. DB 재초기화 (기존 DB는 자동으로 덮어쓰기 확인)
python init_db.py
```

**참고**:
- 새 월별 CSV 추가 시 전체 DB 재구축이 필요합니다 (시계열 통계 재계산)
- 약품명이 변경되어도 약품코드 기준으로 자동 매칭되어 최신 값이 반영됩니다
- 기존 DB는 덮어쓰기 전에 확인 메시지가 표시됩니다

### 파일명 패턴 커스터마이징

`read_csv.py`의 `extract_month_from_file` 함수에서 정규표현식 수정:

```python
patterns = [
    r'(\d{4})[-_]?(\d{2})',  # 2025-01, 202501, 2025_01
    r'(\d{4})년\s*(\d{1,2})월',  # 2025년 1월
    # 추가 패턴...
]
```

### 알림 임계값 설정

런웨이 경고 기준 변경:

```python
# generate_report.py의 analyze_runway 함수에서
if months <= 3:  # 3개월 이하 → 부족 경고
    low_data.append((months, row['약품명']))
else:
    high_data.append((months, row['약품명']))
```

## 🔍 문제 해결

### 일반적인 오류 및 해결방법

1. **"DB가 없습니다" 오류**
   ```
   해결: python init_db.py 실행
   ```

2. **CSV 파일 읽기 오류**
   ```
   해결: Excel에서 'CSV(UTF-8)(*.csv)' 형식으로 다시 저장
   ```

3. **파일명 날짜 인식 오류**
   ```
   해결: 파일명을 YYYY-MM.csv 또는 YYYYMM.csv 형식으로 변경
   예: 2025-01.csv, 202501.csv
   ```

4. **약품코드 중복 문제**
   ```
   해결: 자동으로 float 형태(.0) 제거 및 통합됨
   예: 673400030과 673400030.0이 자동으로 하나로 병합
   ```

5. **인코딩 오류**
   ```
   해결: UTF-8, CP949, EUC-KR 자동 감지 및 변환
   ```

6. **재고가 전부 0으로 표시됨**
   ```
   해결: v3.0에서 해결됨 - 각 약품별 최신 재고 자동 채택
   ```

7. **음수 재고가 양수로 표시됨**
   ```
   해결: v3.0에서 해결됨 - 음수 재고 정확히 반영
   ```

8. **주문 보고서에 모든 약품이 표시됨**
   ```
   해결: v3.0에서 해결됨 - today.csv 약품만 표시
   ```

## 📊 샘플 데이터

프로젝트에 포함된 샘플 CSV 데이터:
- 2023년 9월 ~ 2025년 9월 (25개월)
- 월별 CSV 파일 형태
- 약품 1800+ 종류
- 실제 약국 운영 패턴을 반영한 데이터

## 📝 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다.

## 🤝 기여

버그 리포트, 기능 제안, Pull Request를 환영합니다!

## 📧 연락처

문의사항이 있으시면 GitHub Issues를 통해 연락 주세요.
